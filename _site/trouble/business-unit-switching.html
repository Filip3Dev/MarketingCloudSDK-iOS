<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">

        <title>Journey Builder for Apps iOS SDK (v5.0.0) : Switch Business Units</title>
        <meta name="description" content="">

        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css" rel="stylesheet">
        <link rel="stylesheet" href="/css/syntax.css">
        <link rel="stylesheet" href="/css/main.css">
    </head>
    <body>

        <div class="container">
            <div class=row-fluid>
                <div id=header class=span12>
                    <h4><a class=brand href="/">Journey Builder for Apps iOS SDK (v5.0.0)</a>
    
    
</h4>


                </div>
            </div>

            <div class=row-fluid>
                
                
                    <div id=navigation class=span2>
                        <ul class="nav nav-list">
    <li><a href="/">Home</a></li>
    
        
        

        
    
        
        

        
            
                <li class=nav-header>Get Started</li>
            
            <li data-order="3"><a href="/get-started/implement-sdk.html">Implement and Configure SDK</a></li>
        
            
            <li data-order="2"><a href="/get-started/create-apps-overview.html">Create MobilePush App</a></li>
        
            
            <li data-order="1"><a href="/get-started/apple.html">Provision Mobile App with Apple</a></li>
        
    
        
        

        
    
        
        

        
    
        
        

        
    
        
        

        
            
                <li class=nav-header>Push Notifications</li>
            
            <li data-order="1"><a href="/push-notifications/push-notifications.html">Push Notifications</a></li>
        
            
            <li data-order="4"><a href="/push-notifications/rich-notifications.html">Rich Notifications</a></li>
        
            
            <li data-order="3"><a href="/push-notifications/interactive-notifications.html">Interactive Notifications</a></li>
        
            
            <li data-order="2"><a href="/push-notifications/custom-sound.html">Custom Sound</a></li>
        
    
        
        

        
            
                <li class=nav-header>User Data</li>
            
            <li data-order="1"><a href="/user-data/user-data.html">User Data</a></li>
        
            
            <li data-order="2"><a href="/user-data/contact-key.html">Contact Key</a></li>
        
            
            <li data-order="3"><a href="/user-data/tags.html">Tags</a></li>
        
            
            <li data-order="4"><a href="/user-data/attributes.html">Attributes</a></li>
        
    
        
        

        
            
                <li class=nav-header>OpenDirect</li>
            
            <li data-order="4"><a href="/opendirect/opendirect.html">OpenDirect</a></li>
        
    
        
        

        
            
                <li class=nav-header>Location Services</li>
            
            <li data-order="3"><a href="/location/add-beacons.html">Beacons</a></li>
        
            
            <li data-order="1"><a href="/location/geolocation-overview.html">Overview</a></li>
        
            
            <li data-order="2"><a href="/location/geolocation.html">Background Location Updates</a></li>
        
    
        
        

        
            
                <li class=nav-header>Inbox</li>
            
            <li data-order="1"><a href="/inbox/inbox.html">Inbox</a></li>
        
            
            <li data-order="2"><a href="/inbox/cloudpage-push-overview.html">CloudPage Alert Overview</a></li>
        
    
        
        

        
            
                <li class=nav-header>Analytics</li>
            
            <li data-order="2"><a href="/analytics/personalization-collect.html">Personalization Builder and Collect API Integration</a></li>
        
            
            <li data-order="1"><a href="/analytics/analytics.html">Analytics</a></li>
        
    
        
        

        
            
                <li class=nav-header>Feature Implementation</li>
            
            <li data-order="5"><a href="/features/custom-keys.html">Custom Keys</a></li>
        
    
        
        

        
            
                <li class=nav-header>Troubleshooting</li>
            
            <li data-order="4"><a href="/trouble/sdk-migration.html">SDK Migration</a></li>
        
            
            <li data-order="3"><a href="/trouble/data-migration.html">User Data Migration</a></li>
        
            
            <li data-order="4"><a href="/trouble/business-unit-switching.html">Switch Business Units</a></li>
        
            
            <li data-order="2"><a href="/trouble/multiple-push-sdks.html">Multiple Push SDKs Troubleshooting</a></li>
        
            
            <li data-order="1"><a href="/trouble/ios-debugging.html">iOS Debugging</a></li>
        
    
        
        

        
    
        
        

        
    
<!-- List additional links. It is recommended to add a divider
    e.g. <li class=divider></li> first to break up the content. -->
</ul>

                    </div>

                    <div id=content class=span10>
                        <div class=page-header>
    <h2>Switch Business Units</h2>
</div>

<p>Switch between multiple Marketing Cloud business units using the MarketingCloudSDK. This process can be necessary for your application implementation, such as switching between production and debug tasks.</p>

<p>Switching business units using the AppID value used to configure the application requires you to issue <em>tearDown</em> to the SDK. Follow this call with a standard configure, as typically done in <em>applicationDidFinishLaunchingâ€¦</em>.</p>

<p>Any switch in business units removes any MarketingCloudSDK data from the system. If you enable the previous business unit later via the SDK, data like contactKey, tags and attributes will no longer be set.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- (void) switchToBusinessUnit2
{
    // Tear down the existing instance of the SDK
    [[MarketingCloudSDK sharedInstance] sfmc_tearDown];

    // weak reference to avoid retain cycle within block
    __weak __typeof__(self) weakSelf = self;

    // Reconfigure with a different configuration file.
    NSURL *configurationFileURL = // code to reference your configuration file for BU2
    NSError *configureError = nil;
        BOOL configured = [[MarketingCloudSDK sharedInstance] sfmc_configureWithURL:configurationFileURL configurationIndex:0 error:&amp;configureError
                         completionHandler:^(BOOL success, NSString *appId, NSError *error) {
            // The SDK has been fully configured and is ready for use!

            // set the delegate if needed then ask if we are authorized - the delegate must be set here if used
            [UNUserNotificationCenter currentNotificationCenter].delegate = weakSelf;

            [[UNUserNotificationCenter currentNotificationCenter] requestAuthorizationWithOptions:UNAuthorizationOptionAlert | UNAuthorizationOptionSound | UNAuthorizationOptionBadge
                                                                        completionHandler:^(BOOL granted, NSError * _Nullable error) {
                                                                            if (error == nil) {
                                                                                if (granted == YES) {
                                                                                    os_log_info(OS_LOG_DEFAULT, "Authorized for notifications = %s", granted ? "YES" : "NO");

                                                                                    // we are authorized to use notifications, request a device token for remote notifications
                                                                                    [[UIApplication sharedApplication] registerForRemoteNotifications];
                                                                                }
                                                                            }
                                                                        }];        
        }];
        if (configured == YES) {
            // The configuation process is underway.
        }
    }
    ...
}
</code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey : Any]? = nil) -&gt; Bool {

    // Tear down the existing instance of the SDK
    MarketingCloudSDK.sharedInstance().sfmc_tearDown()
                                weak var weakSelf = self
        do {
            try MarketingCloudSDK.sharedInstance().sfmc_configure(completionHandler: {(_ success: Bool, _ appId: String, _ error: Error?) -&gt; Void in
                // The SDK has been fully configured and is ready for use!
                // set the delegate if needed then ask if we are authorized - the delegate must be set here if used
                UNUserNotificationCenter.current().delegate = weakSelf
                UNUserNotificationCenter.current().requestAuthorization(options: [.alert, .sound, .badge], completionHandler: {(_ granted: Bool, _ error: Error?) -&gt; Void in
                    if error == nil {
                        if granted == true {
                             // we are authorized to use notifications, request a device token for remote notifications
                            UIApplication.shared.registerForRemoteNotifications()
                        }
                    }
                })
            })
            return true
        } catch let error as NSError {
            print("Error: \(error)")
        }
        return false
    }
</code></pre></div></div>

<p>Use a similar approach if you switch between business units for development purposes, such as using a development business unit for testing Marketing Cloud notifications and another business unit for for production releases.</p>

<p>Use a configuration file to contain multiple JSON dictionaries of configuration data, each with a unique appid and access token value from Marketing Cloud.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// MarketingCloudConfiguration.json
[{
  "name": "prod",
  "appid": "&lt;your production appid&gt;",
  "accesstoken": "&lt;your production accesstoken",
  "analytics": true,
  "location": true,
  "inbox": true,
  "loglevel": 0,
}, {
  "name": "development",  
  "appid": "&lt;your development appid&gt;",
  "accesstoken": "&lt;your development accesstoken",
  "analytics": true,
  "location": true,
  "inbox": true,
  "loglevel": 0
 }]
</code></pre></div></div>
<p>Use the index of your configuration when configuring the SDK using the configureWithURL:configuationIndex:error: method.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NSURL *configurationFileURL = // code to reference your configuration file
NSInteger productionIndex = 0; // index of production configuration in the JSON file dictionary
NSInteger debugIndex = 1;
NSError *configureError = nil;
    BOOL configured = [[MarketingCloudSDK sharedInstance] sfmc_configureWithURL:configurationFileURL configurationIndex:debugIndex error:&amp;configureError
                         completionHandler:^(BOOL success, NSString *appId, NSError *error) {
</code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var configurationFileURL = (    // code to reference your configuration file
NSInteger) as? URL
// index of production configuration in the JSON file dictionary
var debugIndex: Int = 1
do {
     try MarketingCloudSDK.shar
</code></pre></div></div>


                    </div>
                
            </div>

            

            <div class=row-fluid>
                <div id=footer class=span12>
                    Documentation for <a href="https://github.com/ExactTarget/JB4A-SDK-iOS" target="_blank">Journey Builder for Apps iOS SDK (v5.0.0)</a>

                </div>
            </div>
        </div>

        <script>
            function orderNav() {
                var list,
                    section,
                    header,
                    sections = [],
                    lists = {},
                    headers = {};

                var navUl = document.querySelectorAll('#navigation ul')[0],
                    navLis = document.querySelectorAll('#navigation ul li');

                if (!navUl) return;

                for (var i = 0; i < navLis.length; i++) {
                    var order, li = navLis[i];

                    if (li.classList.contains('nav-header')) {
                        section = li.textContent || li.innerText;
                        sections.push(section);
                        headers[section] = li;
                        continue;
                    }

                    if (!lists[section]) {
                        lists[section] = [];
                    }

                    order = parseFloat(li.getAttribute('data-order'))
                    lists[section].push([order, li]);
                }

                for (var i = 0; i < sections.length; i++) {
                    section = sections[i];
                    list = lists[section].sort(function(a, b) {
                        return a[0] - b[0];
                    });

                    if (header = headers[section]) {
                        navUl.appendChild(header);
                    }
                    for (var j = 0; j < list.length; j++) {
                        navUl.appendChild(list[j][1]);
                    }
                }
            }

            if (document.querySelectorAll) orderNav();
        </script>

        
            <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-82902574-4', 'auto');
  ga('send', 'pageview');
</script>

        
    </body>
</html>
