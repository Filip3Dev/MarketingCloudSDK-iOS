<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">

        <title>MarketingCloudSDK iOS (v5.0.0) : Background Location Updates</title>
        <meta name="description" content="">

        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css" rel="stylesheet">
        <link rel="stylesheet" href="/css/syntax.css">
        <link rel="stylesheet" href="/css/main.css">
    </head>
    <body>

        <div class="container">
            <div class=row-fluid>
                <div id=header class=span12>
                    <h4><a class=brand href="/">MarketingCloudSDK iOS (v5.0.0)</a>
    
    
</h4>


                </div>
            </div>

            <div class=row-fluid>
                
                
                    <div id=navigation class=span2>
                        <ul class="nav nav-list">
    <li><a href="/">Home</a></li>
    
        
        

        
    
        
        

        
            
                <li class=nav-header>Get Started</li>
            
            <li data-order="3"><a href="/get-started/implement-sdk.html">Implement and Configure SDK</a></li>
        
            
            <li data-order="2"><a href="/get-started/create-apps-overview.html">Create MobilePush App</a></li>
        
            
            <li data-order="1"><a href="/get-started/apple.html">Provision Mobile App with Apple</a></li>
        
    
        
        

        
    
        
        

        
    
        
        

        
            
                <li class=nav-header>SDK Implementation</li>
            
            <li data-order="4"><a href="/sdk-implementation/sdk-migration.html">SDK Migration</a></li>
        
            
            <li data-order="5"><a href="/sdk-implementation/business-unit-switching.html">Switch Business Units</a></li>
        
    
        
        

        
            
                <li class=nav-header>Push Notifications</li>
            
            <li data-order="1"><a href="/push-notifications/push-notifications.html">Push Notifications</a></li>
        
            
            <li data-order="4"><a href="/push-notifications/rich-notifications.html">Rich Notifications</a></li>
        
            
            <li data-order="3"><a href="/push-notifications/interactive-notifications.html">Interactive Notifications</a></li>
        
            
            <li data-order="2"><a href="/push-notifications/custom-sound.html">Custom Sound</a></li>
        
    
        
        

        
            
                <li class=nav-header>User Data</li>
            
            <li data-order="1"><a href="/user-data/user-data.html">User Data</a></li>
        
            
            <li data-order="2"><a href="/user-data/contact-key.html">Contact Key</a></li>
        
            
            <li data-order="6"><a href="/user-data/data-migration.html">User Data Migration</a></li>
        
            
            <li data-order="3"><a href="/user-data/tags.html">Tags</a></li>
        
            
            <li data-order="4"><a href="/user-data/attributes.html">Attributes</a></li>
        
    
        
        

        
            
                <li class=nav-header>OpenDirect</li>
            
            <li data-order="4"><a href="/opendirect/opendirect.html">OpenDirect</a></li>
        
    
        
        

        
            
                <li class=nav-header>Location Services</li>
            
            <li data-order="3"><a href="/location/add-beacons.html">Beacons</a></li>
        
            
            <li data-order="1"><a href="/location/geolocation-overview.html">Overview</a></li>
        
            
            <li data-order="2"><a href="/location/geolocation.html">Background Location Updates</a></li>
        
    
        
        

        
            
                <li class=nav-header>Inbox</li>
            
            <li data-order="1"><a href="/inbox/inbox.html">Inbox</a></li>
        
            
            <li data-order="2"><a href="/inbox/cloudpage-push-overview.html">CloudPage Alert Overview</a></li>
        
    
        
        

        
            
                <li class=nav-header>Analytics</li>
            
            <li data-order="2"><a href="/analytics/personalization-collect.html">Personalization Builder and Collect API Integration</a></li>
        
            
            <li data-order="1"><a href="/analytics/analytics.html">Analytics</a></li>
        
    
        
        

        
            
                <li class=nav-header>Feature Implementation</li>
            
            <li data-order="5"><a href="/features/custom-keys.html">Custom Keys</a></li>
        
    
        
        

        
            
                <li class=nav-header>Troubleshooting</li>
            
            <li data-order="2"><a href="/trouble/multiple-push-sdks.html">Multiple Push SDKs Troubleshooting</a></li>
        
            
            <li data-order="1"><a href="/trouble/ios-debugging.html">iOS Debugging</a></li>
        
    
        
        

        
    
        
        

        
    
<!-- List additional links. It is recommended to add a divider
    e.g. <li class=divider></li> first to break up the content. -->
</ul>

                    </div>

                    <div id=content class=span10>
                        <div class=page-header>
    <h2>Background Location Updates</h2>
</div>

<p>Normally, the app downloads new regions and messages as the device moves more than 5 kilometers from the last location and download of this data. However, if your app serves customers who spend a lot of time within a single 5K radius, consider adding the ability to do a background refresh of regions and messages. Since Apple controls when this background refresh takes place, we cannot guarantee when the refresh occurs. However, Apple allows the SDK to download new regions and messages for those times your customer spends a considerable amount of time in a single 5K region.</p>

<p>In your Info.plist, implement this key to enable this function. We require “App downloads content from the network” to perform a Background App Refresh periodically to refresh geofences and beacons.</p>

<p><br />
<img class="img-responsive" src="/assets/background_modes_plist_entry.png" /><br /></p>

<p>In your application delegate method -application:didFinishLaunchingWithOptions:, implement this code:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
    ...

    if ( [[UIApplication sharedApplication] backgroundRefreshStatus] == UIBackgroundRefreshStatusAvailable )
    {
        // setting this will enable iOS to call the app delegate method performFetchWithCompletionHandler periodically. The implementation of that method (see below)
        // will call the MarketingCloudSDK at most once per day to update location and proximity messages in the background - if those services have been enabled.
        // Only call this method if you have enabled location in your MarketingCloudConfiguration.json file
        // Note that you will require "App downloads content from the network" in your plist for this background app refresh to work
        [[UIApplication sharedApplication] setMinimumBackgroundFetchInterval:UIApplicationBackgroundFetchIntervalMinimum];
    }
}

func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey : Any]? = nil) -&gt; Bool {
    ...
    if UIApplication.shared.backgroundRefreshStatus == .available {
        // setting this will enable iOS to call the app delegate method performFetchWithCompletionHandler periodically. The implementation of that method (see below)
        // will call the MarketingCloudSDK at most once per day to update location and proximity messages in the background - if those services have been enabled.
        // Only call this method if you have enabled location in your MarketingCloudConfiguration.json file
        // Note that you will require "App downloads content from the network" in your plist for this background app refresh to work
        UIApplication.shared.setMinimumBackgroundFetchInterval(UIApplicationBackgroundFetchIntervalMinimum)
}
</code></pre></div></div>

<p>Implement the handler for this functionality in your application delegate class:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// this method will be called by iOS to tell the MarketingCloudSDK to update location and proximity messages. This will only be called if [[UIApplication sharedApplication] setMinimumBackgroundFetchInterval:
// has been set to a value other than UIApplicationBackgroundFetchIntervalNever and Background App Refresh is enabled.
-(void)application:(UIApplication *)application performFetchWithCompletionHandler:(void (^)(UIBackgroundFetchResult) completionHandler
{
    [[MarketingCloudSDK sharedInstance] sfmc_refreshWithFetchCompletionHandler:completionHandler];
}
</code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// this method will be called by iOS to tell the MarketingCloudSDK to update location and proximity messages. This will only be called if [[UIApplication sharedApplication] setMinimumBackgroundFetchInterval:
// has been set to a value other than UIApplicationBackgroundFetchIntervalNever and Background App Refresh is enabled.
func application(_ application: UIApplication, performFetchWithCompletionHandler completionHandler: @escaping (UIBackgroundFetchResult) -&gt; Void) {
    MarketingCloudSDK.sharedInstance().sfmc_refresh(fetchCompletionHandler: completionHandler)
}
</code></pre></div></div>

<p>See MarketingCloudSDK+Base.h for more information regarding this method.</p>


                    </div>
                
            </div>

            

            <div class=row-fluid>
                <div id=footer class=span12>
                    Documentation for <a href="https://github.com/ExactTarget/JB4A-SDK-iOS" target="_blank">MarketingCloudSDK iOS (v5.0.0)</a>

                </div>
            </div>
        </div>

        <script>
            function orderNav() {
                var list,
                    section,
                    header,
                    sections = [],
                    lists = {},
                    headers = {};

                var navUl = document.querySelectorAll('#navigation ul')[0],
                    navLis = document.querySelectorAll('#navigation ul li');

                if (!navUl) return;

                for (var i = 0; i < navLis.length; i++) {
                    var order, li = navLis[i];

                    if (li.classList.contains('nav-header')) {
                        section = li.textContent || li.innerText;
                        sections.push(section);
                        headers[section] = li;
                        continue;
                    }

                    if (!lists[section]) {
                        lists[section] = [];
                    }

                    order = parseFloat(li.getAttribute('data-order'))
                    lists[section].push([order, li]);
                }

                for (var i = 0; i < sections.length; i++) {
                    section = sections[i];
                    list = lists[section].sort(function(a, b) {
                        return a[0] - b[0];
                    });

                    if (header = headers[section]) {
                        navUl.appendChild(header);
                    }
                    for (var j = 0; j < list.length; j++) {
                        navUl.appendChild(list[j][1]);
                    }
                }
            }

            if (document.querySelectorAll) orderNav();
        </script>

        
            <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-82902574-4', 'auto');
  ga('send', 'pageview');
</script>

        
    </body>
</html>
