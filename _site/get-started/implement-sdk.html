<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">

        <title>MarketingCloudSDK iOS (v5.0.0) : Implement and Configure SDK</title>
        <meta name="description" content="">

        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css" rel="stylesheet">
        <link rel="stylesheet" href="/css/syntax.css">
        <link rel="stylesheet" href="/css/main.css">
    </head>
    <body>

        <div class="container">
            <div class=row-fluid>
                <div id=header class=span12>
                    <h4><a class=brand href="/">MarketingCloudSDK iOS (v5.0.0)</a>
    
    
</h4>


                </div>
            </div>

            <div class=row-fluid>
                
                
                    <div id=navigation class=span2>
                        <ul class="nav nav-list">
    <li><a href="/">Home</a></li>
    
        
        

        
    
        
        

        
            
                <li class=nav-header>Get Started</li>
            
            <li data-order="3"><a href="/get-started/implement-sdk.html">Implement and Configure SDK</a></li>
        
            
            <li data-order="2"><a href="/get-started/create-apps-overview.html">Create MobilePush App</a></li>
        
            
            <li data-order="1"><a href="/get-started/apple.html">Provision Mobile App with Apple</a></li>
        
    
        
        

        
    
        
        

        
    
        
        

        
            
                <li class=nav-header>SDK Implementation</li>
            
            <li data-order="4"><a href="/sdk-implementation/sdk-migration.html">SDK Migration</a></li>
        
            
            <li data-order="5"><a href="/sdk-implementation/business-unit-switching.html">Switch Business Units</a></li>
        
    
        
        

        
            
                <li class=nav-header>Push Notifications</li>
            
            <li data-order="1"><a href="/push-notifications/push-notifications.html">Push Notifications</a></li>
        
            
            <li data-order="4"><a href="/push-notifications/rich-notifications.html">Rich Notifications</a></li>
        
            
            <li data-order="3"><a href="/push-notifications/interactive-notifications.html">Interactive Notifications</a></li>
        
            
            <li data-order="2"><a href="/push-notifications/custom-sound.html">Custom Sound</a></li>
        
    
        
        

        
            
                <li class=nav-header>User Data</li>
            
            <li data-order="1"><a href="/user-data/user-data.html">User Data Overview</a></li>
        
            
            <li data-order="2"><a href="/user-data/contact-key.html">Contact Key</a></li>
        
            
            <li data-order="6"><a href="/user-data/data-migration.html">User Data Migration</a></li>
        
            
            <li data-order="3"><a href="/user-data/tags.html">Tags</a></li>
        
            
            <li data-order="4"><a href="/user-data/attributes.html">Attributes</a></li>
        
    
        
        

        
            
                <li class=nav-header>OpenDirect</li>
            
            <li data-order="4"><a href="/opendirect/opendirect.html">OpenDirect</a></li>
        
    
        
        

        
            
                <li class=nav-header>Location Services</li>
            
            <li data-order="3"><a href="/location/add-beacons.html">Beacons</a></li>
        
            
            <li data-order="1"><a href="/location/geolocation-overview.html">Overview</a></li>
        
            
            <li data-order="2"><a href="/location/geolocation.html">Background Location Updates</a></li>
        
    
        
        

        
            
                <li class=nav-header>Inbox</li>
            
            <li data-order="1"><a href="/inbox/inbox.html">Inbox</a></li>
        
            
            <li data-order="2"><a href="/inbox/cloudpage-push-overview.html">CloudPage Alert Overview</a></li>
        
    
        
        

        
            
                <li class=nav-header>Analytics</li>
            
            <li data-order="2"><a href="/analytics/personalization-collect.html">Personalization Builder and Collect API Integration</a></li>
        
            
            <li data-order="1"><a href="/analytics/analytics.html">Analytics</a></li>
        
    
        
        

        
            
                <li class=nav-header>Feature Implementation</li>
            
            <li data-order="5"><a href="/features/custom-keys.html">Custom Keys</a></li>
        
    
        
        

        
            
                <li class=nav-header>Troubleshooting</li>
            
            <li data-order="2"><a href="/trouble/multiple-push-sdks.html">Multiple Push SDKs Troubleshooting</a></li>
        
            
            <li data-order="1"><a href="/trouble/ios-debugging.html">iOS Debugging</a></li>
        
    
        
        

        
    
        
        

        
    
<!-- List additional links. It is recommended to add a divider
    e.g. <li class=divider></li> first to break up the content. -->
</ul>

                    </div>

                    <div id=content class=span10>
                        <div class=page-header>
    <h2>Implement and Configure the SDK in your iOS App</h2>
</div>

<p>To implement the MarketingCloudSDK framework in your application, use either CocoaPods or a manual setup of the SDK.</p>

<h2 id="implement-the-sdk-with-cocoapods">Implement the SDK with CocoaPods</h2>

<p>Follow the <a href="https://guides.cocoapods.org/using/using-cocoapods.html">CocoaPods</a> using <strong>MarketingCloudSDK</strong> as a dependency in the podfile. Open up the .xcworkspace created by the install process with Xcode and start using the SDK.</p>

<p>Do <strong>NOT</strong> use .xcodeproj. An error occurs if you open up a project file instead of a workspace.</p>

<h2 id="implement-the-sdk-manually">Implement the SDK Manually</h2>

<ol>
  <li><a href="https://github.com/ExactTarget/JB4A-SDK-iOS">Download the SDK</a>.</li>
  <li>Copy the MarketingCloudSDK directory from your download to your project directory
<br />
<img class="img-responsive" src="/assets/SDKConfigure1.png" /><br /></li>
  <li>Open your application project and select the appropriate target.
<br />
<img class="img-responsive" src="/assets/SDKConfigure2.png" /><br /></li>
  <li>Add MarketingCloudSDK.framework to Linked Frameworks and Libraries in your target’s General settings.
<img class="img-responsive" src="/assets/SDKConfigure3.png" /><br /></li>
  <li>Add MarketingCloudSDK.bundle to Copy Bundle Resources in your target’s Build Phases settings.
<img class="img-responsive" src="/assets/SDKConfigure4.png" /><br /></li>
  <li>Add -ObjC to your target’s Other Linker Flags build settings.
<img class="img-responsive" src="/assets/SDKConfigure5.png" /><br /></li>
</ol>

<blockquote>
  <p><a href="https://developer.apple.com/library/content/qa/qa1490/_index.html">Review additional information about this linker flag</a></p>
</blockquote>

<h2 id="configure-the-sdk">Configure the SDK</h2>

<p>MarketingCloudSDK framework via a JSON file added to your application. This file contains the parameters unique to your application and feature needs. The MarketingCloudSDK framework reads the values within this file and completes its configuration based on these settings.</p>

<ol>
  <li>Add MarketingCloudSDKConfiguration.json to Copy Bundle Resources in your target’s Build Phases settings.
<img class="img-responsive" src="/assets/SDKConfigure6.png" /><br /></li>
  <li>Change the <em>appid</em> and <em>accesstoken</em> values to match the information from your Marketing Cloud account when you configured your application. These values represent the unique paring of this iOS application with the Marketing Cloud account used for MobilePush.</li>
  <li>Enable or disable <em>analytics</em>, <em>location</em>, or <em>inbox</em> entries depending on the unique needs of your application and your usage of Marketing Cloud.
    <blockquote>
      <p>Marketing Cloud and the Mobile Push MarketingCloudSDK framework support push notifications.</p>
    </blockquote>
  </li>
  <li>To implement push notification handling in your application, ensure you created an APNS Push Certificate in the Apple developer portal and added that to your Marketing Cloud account. Make sure that you added the push notifications feature to your application in the Apple developer portal. Enable push notifications in  your target’s Capabilities settings.
<img class="img-responsive" src="/assets/SDKConfigure7.png" /><br />
    <blockquote>
      <p>When implementing the MarketingCloudSDK framework, note that all method names contain the prefix <em>sfmc_</em>. This convention allows the application implementing the SDK to protect against the possibility of namespace collisions between external libraries it may use. We’ve taken every precaution to ensure that MarketingCloudSDK does not cause compile, link, or runtime collisions with other code your application may implement. Review Apple’s <a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/ProgrammingWithObjectiveC/CustomizingExistingClasses/CustomizingExistingClasses.html#//apple_ref/doc/uid/TP40011210-CH6-SW4">documentation on customizing existing classes</a> for further information.</p>
    </blockquote>
  </li>
  <li>In your application delegate, import the framework header to enable MarketingCloudSDK functionality.
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#import &lt;MarketingCloudSDK/MarketingCloudSDK.h&gt;
</code></pre></div>    </div>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import MarketingCloudSDK
</code></pre></div>    </div>
  </li>
  <li>In your application delegate class, add these sections of code to ensure that your application registers for and handles push notifications. Set your AppDelegate class to adhere to the UNUserNotificationCenterDelegate protocol.
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AppDelegate ()&lt;UNUserNotificationCenterDelegate&gt;
...
</code></pre></div>    </div>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class AppDelegate: UNUserNotificationCenterDelegate
...
</code></pre></div>    </div>
  </li>
  <li>In your application delegate method <em>-application:didFinishLaunchingWithOptions:</em>, create an instance of the MarketingCloudSDK and configure it for use, setting the push delegate and requesting push authorization. Only init or configure in didFinishingLaunching.
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-(BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
 ...
 // weak reference to avoid retain cycle within block
 __weak __typeof__(self) weakSelf = self;

 NSError *configureError = nil;
     BOOL configured = [[MarketingCloudSDK sharedInstance] sfmc_configure:&amp;configureError
                      completionHandler:^(BOOL success, NSString *appId, NSError *error) {
         // The SDK has been fully configured and is ready for use!

         // set the delegate if needed then ask if we are authorized - the delegate must be set here if used
         [UNUserNotificationCenter currentNotificationCenter].delegate = weakSelf;

         dispatch_async(dispatch_get_main_queue(), ^{
         [[UNUserNotificationCenter currentNotificationCenter] requestAuthorizationWithOptions:UNAuthorizationOptionAlert | UNAuthorizationOptionSound | UNAuthorizationOptionBadge
                                                                     completionHandler:^(BOOL granted, NSError * _Nullable error) {
                                                                         if (error == nil) {
                                                                             if (granted == YES) {
                                                                                         dispatch_async(dispatch_get_main_queue(), ^{
                                                                                 // we are authorized to use notifications, request a device token for remote notifications
                                                                                 [[UIApplication sharedApplication] registerForRemoteNotifications];
                                                                                 });
                                                                             }
                                                                         }
                                                                     }];
                                                                     });        
     }];
     if (configured == YES) {
         // The configuation process is underway.
     }
 }
 ...  
</code></pre></div>    </div>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey : Any]? = nil) -&gt; Bool {
 // weak reference to avoid retain cycle within block
 weak var weakSelf = self
 do {
     try MarketingCloudSDK.sharedInstance().sfmc_configure(completionHandler: {(_ success: Bool, _ appId: String, _ error: Error?) -&gt; Void in
         // The SDK has been fully configured and is ready for use!
         // set the delegate if needed then ask if we are authorized - the delegate must be set here if used
         UNUserNotificationCenter.current().delegate = weakSelf
         UNUserNotificationCenter.current().requestAuthorization(options: [.alert, .sound, .badge], completionHandler: {(_ granted: Bool, _ error: Error?) -&gt; Void in
             if error == nil {
                 if granted == true {
                      // we are authorized to use notifications, request a device token for remote notifications
                     UIApplication.shared.registerForRemoteNotifications()
                 }
             }
         })
     })
     return true
 } catch let error as NSError {
     print("Error: \(error)")
 }
 return false
}
</code></pre></div>    </div>
  </li>
</ol>

<p>Configuration of the MarketingCloudSDK includes a synchronous return of the BOOL return value and asynchronous process to complete configuration. We recommend your application rely on the <em>success</em> and <em>error</em> values returned in the <em>completionHandler</em> to verify successful configuration. The <em>MarketingCloudSDK+Base.h</em> header file details additional methods for configuration.</p>

<p>Add the required delegate methods to support push notifications to your AppDelegate class.</p>

<p>These methods use  MarketingCloudSDK methods to enable the framework’s functionality to manage push notifications, which includes MobilePush contact registration and push analytics tracking.</p>

<p>If the methods below are implemented <em>without</em> using the MarketingCloudSDK methods as shown, MobilePush functionality does not work as expected. If the methods below are not implemented, MobilePush functionality <strong>will not</strong> work as expected.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- (void)application:(UIApplication *)application didRegisterForRemoteNotificationsWithDeviceToken:(NSData *)deviceToken {
    [[MarketingCloudSDK sharedInstance] sfmc_setDeviceToken:deviceToken];
}

- (void)application:(UIApplication *)application didFailToRegisterForRemoteNotificationsWithError:(NSError *)error {
    os_log_debug(OS_LOG_DEFAULT, "didFailToRegisterForRemoteNotificationsWithError = %@", error);
}

// The method will be called on the delegate when the user responded to the notification by opening the application, dismissing the notification or choosing a UNNotificationAction. The delegate must be set before the application returns from applicationDidFinishLaunching:.
- (void)userNotificationCenter:(UNUserNotificationCenter *)center didReceiveNotificationResponse:(UNNotificationResponse *)response withCompletionHandler:(void(^)(void))completionHandler {

    // tell the MarketingCloudSDK about the notification
     [[MarketingCloudSDK sharedInstance] sfmc_setNotificationRequest:response.notification.request];

    if (completionHandler != nil) {
        completionHandler();
    }
}

// This method is REQUIRED for correct functionality of the SDK.
// This method will be called on the delegate when the application receives a silent push

-(void)application:(UIApplication *)application didReceiveRemoteNotification:(NSDictionary *)userInfo fetchCompletionHandler:(void (^)(UIBackgroundFetchResult))completionHandler
{
    UNMutableNotificationContent *theSilentPushContent = [[UNMutableNotificationContent alloc] init];
    theSilentPushContent.userInfo = userInfo;
    UNNotificationRequest *theSilentPushRequest = [UNNotificationRequest requestWithIdentifier:[NSUUID UUID].UUIDString content:theSilentPushContent trigger:nil];

    [[MarketingCloudSDK sharedInstance] sfmc_setNotificationRequest:theSilentPushRequest];

    completionHandler(UIBackgroundFetchResultNewData);
}
</code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    func application(_ application: UIApplication, didRegisterForRemoteNotificationsWithDeviceToken deviceToken: Data) {
        MarketingCloudSDK.sharedInstance().sfmc_setDeviceToken(deviceToken)
    }


    func application(_ application: UIApplication, didFailToRegisterForRemoteNotificationsWithError error: Error) {
    }

    // The method will be called on the delegate when the user responded to the notification by opening the application, dismissing the notification or choosing a UNNotificationAction. The delegate must be set before the application returns from applicationDidFinishLaunching:.
    func userNotificationCenter(_ center: UNUserNotificationCenter, didReceive response: UNNotificationResponse, withCompletionHandler completionHandler: @escaping () -&gt; Void) {
        // tell the MarketingCloudSDK about the notification
        MarketingCloudSDK.sharedInstance().sfmc_setNotificationRequest(response.notification.request)
        completionHandler()
        }
    }

    // This method is REQUIRED for correct functionality of the SDK.
    // This method will be called on the delegate when the application receives a silent push
    func application(_ application: UIApplication, didReceiveRemoteNotification userInfo: [AnyHashable : Any], fetchCompletionHandler completionHandler: @escaping (UIBackgroundFetchResult) -&gt; Void) {
        let theSilentPushContent = UNMutableNotificationContent()
        theSilentPushContent.userInfo = userInfo
        let theSilentPushRequest = UNNotificationRequest(identifier:UUID().uuidString, content: theSilentPushContent, trigger: nil)
        MarketingCloudSDK.sharedInstance().sfmc_setNotificationRequest(theSilentPushRequest)

        completionHandler(.newData)
    }
</code></pre></div></div>


                    </div>
                
            </div>

            

            <div class=row-fluid>
                <div id=footer class=span12>
                    Documentation for <a href="https://github.com/ExactTarget/JB4A-SDK-iOS" target="_blank">MarketingCloudSDK iOS (v5.0.0)</a>

                </div>
            </div>
        </div>

        <script>
            function orderNav() {
                var list,
                    section,
                    header,
                    sections = [],
                    lists = {},
                    headers = {};

                var navUl = document.querySelectorAll('#navigation ul')[0],
                    navLis = document.querySelectorAll('#navigation ul li');

                if (!navUl) return;

                for (var i = 0; i < navLis.length; i++) {
                    var order, li = navLis[i];

                    if (li.classList.contains('nav-header')) {
                        section = li.textContent || li.innerText;
                        sections.push(section);
                        headers[section] = li;
                        continue;
                    }

                    if (!lists[section]) {
                        lists[section] = [];
                    }

                    order = parseFloat(li.getAttribute('data-order'))
                    lists[section].push([order, li]);
                }

                for (var i = 0; i < sections.length; i++) {
                    section = sections[i];
                    list = lists[section].sort(function(a, b) {
                        return a[0] - b[0];
                    });

                    if (header = headers[section]) {
                        navUl.appendChild(header);
                    }
                    for (var j = 0; j < list.length; j++) {
                        navUl.appendChild(list[j][1]);
                    }
                }
            }

            if (document.querySelectorAll) orderNav();
        </script>

        
            <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-82902574-4', 'auto');
  ga('send', 'pageview');
</script>

        
    </body>
</html>
